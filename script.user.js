// ==UserScript==
// @name GitHub package links
// @description A userscript that generates links for packages in dependency files like package.json, composer.json, Gemfile on GitHub.
// @namespace https://github.com/kubk
// @author https://github.com/kubk
// @homepage https://github.com/kubk/github-package-links
// @version 1.0
// @grant none
// @match https://github.com/*
// ==/UserScript==

!function(){"use strict";function e(r){if(n[r])return n[r].exports;var a=n[r]={i:r,l:!1,exports:{}};return t[r].call(a.exports,a,a.exports,e),a.l=!0,a.exports}var t,n;n={},e.m=t=[function(e,t,n){var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.PackageManager||(t.PackageManager={})).Npm="npm",r.Composer="composer",r.Pip="pip",r.RubyGems="rubyGems",r.Gopkg="gopkg"},function(e,t,n){function r(){return document.querySelector(".highlight.tab-size")}Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),o=n(6),c=r();c&&a.replaceDependencies(c,window.location.href),document.body.addEventListener("click",(function(e){var t=e.target;t&&t instanceof HTMLElement&&t.classList.contains("js-navigation-open")&&o.waitForCondition(r,(function(e){a.replaceDependencies(e,window.location.href)}))}))},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),a=n(4),o=n(5);t.replaceDependencies=function(e,t){var n=r.findPackageManager(t);n&&a.filterPackages(n,e).forEach((function(e){var t=e.querySelector(".pl-s:first-child");if((t=t||e.querySelector(".blob-code-inner"))&&t.textContent){var r=t.textContent.replace(/["']/g,"");r.includes("name = ")&&(r=r.replace("name = ","").replace(/\s+/,""));var a=o.generatePackageLink(n,r);if(a){var i=c(a,r);t.innerHTML=t.outerHTML.replace(r,i)}}}))};var c=function(e,t){var n=document.createElement("a");return n.setAttribute("href",e),n.setAttribute("target","_blank"),n.innerText=t,n.outerHTML}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.findPackageManager=function(e){switch(!0){case e.endsWith("Gemfile")||e.endsWith("gems.rb"):return r.PackageManager.RubyGems;case e.endsWith("Gopkg.toml"):return r.PackageManager.Gopkg;case e.endsWith("package.json")||e.endsWith("bower.json"):return r.PackageManager.Npm;case/requirements.*txt$/.test(e):return r.PackageManager.Pip;case e.endsWith("composer.json"):return r.PackageManager.Composer;default:return null}}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.filterPackages=function(e,t){switch(e){case r.PackageManager.Composer:return Array.from(t.querySelectorAll("tr")).reduce((function(e,t){return t.textContent&&t.textContent.includes("require")?e.concat(a(t,"}")):e}),[]);case r.PackageManager.Npm:return Array.from(t.querySelectorAll("tr")).reduce((function(e,t){return t.textContent&&t.textContent.includes("ependencies")?e.concat(a(t,"}")):e}),[]);case r.PackageManager.RubyGems:return Array.from(t.querySelectorAll("tr td.js-file-line")).filter((function(e){if(!e.textContent)return!1;var t=e.textContent.includes("gem "),n=e.textContent.includes("#");return t&&!n}));case r.PackageManager.Gopkg:return Array.from(t.querySelectorAll("tr")).filter((function(e){if(!e.textContent)return!1;var t=e.textContent.includes('name = "github.com/'),n=e.textContent.includes("#");return t&&!n}));case r.PackageManager.Pip:return Array.from(t.querySelectorAll("tr"))}};var a=function(e,t){for(var n=[];e.nextElementSibling&&(!e.textContent||!e.textContent.includes(t));)n.push(e),e=e.nextElementSibling;return n}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.generatePackageLink=function(e,t){switch(e){case r.PackageManager.Npm:return["devDependencies","dependencies","peerDependencies","optionalDependencies"].includes(t)?null:"https://www.npmjs.com/package/"+t;case r.PackageManager.Composer:return t.includes("/")?"https://packagist.org/packages/"+t:null;case r.PackageManager.RubyGems:return 0<t.length?"https://rubygems.org/gems/"+t:null;case r.PackageManager.Gopkg:return 0<t.length?"https://"+t:null;case r.PackageManager.Pip:if(t.length<1||t.startsWith("git+"))return null;var n=t.match(/^\w+/);return n?"https://pypi.python.org/pypi/"+n[0]:null}}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.waitForCondition=function(e,n,r){if(void 0===r&&(r=0),!(10<r)){var a=e();a?n(a):setTimeout((function(){t.waitForCondition(e,n,r+1)}),100)}}}],e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:r})},e.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var a in t)e.d(r,a,function(e){return t[e]}.bind(null,a));return r},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},e.p="",e(e.s=1)}();