// ==UserScript==
// @name GitHub package links
// @description A userscript that generates links for packages in dependency files like package.json, composer.json, Gemfile on GitHub.
// @namespace https://github.com/kubk
// @author https://github.com/kubk
// @homepage https://github.com/kubk/github-package-links
// @version 1.0
// @grant none
// @match https://github.com/*
// ==/UserScript==

!function(){"use strict";!function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Npm="npm",e.Composer="composer",e.Pip="pip",e.RubyGems="rubyGems",e.Gopkg="gopkg"}(t.PackageManager||(t.PackageManager={}))},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),a=n(6),o=document.querySelector(".highlight.tab-size");o&&r.replaceDependencies(o,window.location.href),document.body.addEventListener("click",function(e){var t=e.target;t&&t.classList.contains("js-navigation-open")&&a.waitForElement(".highlight.tab-size",function(e){r.replaceDependencies(e,window.location.href)})})},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),a=n(4),o=n(5);t.replaceDependencies=function(e,t){var n=r.findPackageManager(t);n&&a.filterPackages(n,e).forEach(function(e){var t=e.querySelector(".pl-s:first-child");if(t||(t=e.querySelector(".blob-code-inner")),t&&t.textContent){var r=t.textContent.replace(/["']/g,"");r.includes("name = ")&&(r=r.replace("name = ","").replace(/\s+/,""));var a=o.generatePackageLink(n,r);if(a){var i=c(a,r);t.innerHTML=t.outerHTML.replace(r,i)}}})};var c=function(e,t){var n=document.createElement("a");return n.setAttribute("href",e),n.setAttribute("target","_blank"),n.innerText=t,n.outerHTML}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.findPackageManager=function(e){switch(!0){case e.endsWith("Gemfile")||e.endsWith("gems.rb"):return r.PackageManager.RubyGems;case e.endsWith("Gopkg.toml"):return r.PackageManager.Gopkg;case e.endsWith("package.json")||e.endsWith("bower.json"):return r.PackageManager.Npm;case/requirements.*txt$/.test(e):return r.PackageManager.Pip;case e.endsWith("composer.json"):return r.PackageManager.Composer;default:return null}}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.filterPackages=function(e,t){switch(e){case r.PackageManager.Composer:return Array.from(t.querySelectorAll("tr")).reduce(function(e,t){return t.textContent&&t.textContent.includes("require")?e.concat(a(t,"}")):e},[]);case r.PackageManager.Npm:return Array.from(t.querySelectorAll("tr")).reduce(function(e,t){return t.textContent&&t.textContent.includes("ependencies")?e.concat(a(t,"}")):e},[]);case r.PackageManager.RubyGems:return Array.from(t.querySelectorAll("tr td.js-file-line")).filter(function(e){return e.textContent&&e.textContent.includes("gem ")&&!e.textContent.includes("#")});case r.PackageManager.Gopkg:return Array.from(t.querySelectorAll("tr")).filter(function(e){return e.textContent&&e.textContent.includes('name = "github.com/')&&!e.textContent.includes("#")});case r.PackageManager.Pip:return Array.from(t.querySelectorAll("tr"))}};var a=function(e,t){for(var n=[];e.nextElementSibling&&(!e.textContent||!e.textContent.includes(t));)n.push(e),e=e.nextElementSibling;return n}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.generatePackageLink=function(e,t){switch(e){case r.PackageManager.Npm:return["devDependencies","dependencies","peerDependencies","optionalDependencies"].includes(t)?null:"https://www.npmjs.com/package/"+t;case r.PackageManager.Composer:return t.includes("/")?"https://packagist.org/packages/"+t:null;case r.PackageManager.RubyGems:return t.length>0?"https://rubygems.org/gems/"+t:null;case r.PackageManager.Gopkg:return t.length>0?"https://"+t:null;case r.PackageManager.Pip:if(t.length<1||t.startsWith("git+"))return null;var n=t.match(/^\w+/);return n?"https://pypi.python.org/pypi/"+n[0]:null}}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.waitForElement=function(e,n,r){if(void 0===r&&(r=0),!(r>10)){var a=document.querySelector(e);a?n(a):setTimeout(function(){t.waitForElement(e,n,r+1)},100)}}}])}();